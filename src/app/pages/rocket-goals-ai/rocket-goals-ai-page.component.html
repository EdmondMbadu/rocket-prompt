<div class="flex h-screen flex-col bg-neutral-50">
  <!-- Header -->
  <header class="flex items-center justify-between border-b border-neutral-200 bg-white px-6 py-4">
    <div class="flex items-center gap-4">
      <div class="flex h-11 w-11 items-center justify-center rounded-xl bg-white shadow-lg ring-1 ring-neutral-200">
        <svg viewBox="0 0 24 24" class="h-6 w-6 text-red-500" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 006.16-12.12A14.98 14.98 0 009.63 8.41m5.96 5.96a14.926 14.926 0 01-5.84 2.58m-.1-8.57L6.98 9.8a2 2 0 00-.23 2.33l3.35 5.35m.1-8.57l-3.8 3.78a2 2 0 00.09 2.9l3.71 3.3" />
        </svg>
      </div>
      <div>
        <h1 class="text-lg font-semibold text-neutral-900">RocketGoals AI</h1>
        <p class="text-sm text-neutral-500">Powered by Gemini</p>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <button
        *ngIf="messages().length > 0"
        type="button"
        class="flex items-center gap-2 rounded-lg border border-neutral-200 bg-white px-4 py-2 text-sm font-medium text-neutral-600 transition hover:bg-neutral-50 hover:text-neutral-900"
        [class.text-red-600]="isConversationCopied()"
        [class.bg-red-50]="isConversationCopied()"
        [class.border-red-200]="isConversationCopied()"
        (click)="copyConversation()"
        [attr.aria-label]="isConversationCopied() ? 'Conversation copied!' : 'Copy conversation'"
        title="Copy entire conversation"
      >
        <svg 
          *ngIf="!isConversationCopied()"
          viewBox="0 0 24 24" 
          class="h-4 w-4" 
          fill="none" 
          stroke="currentColor" 
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
        </svg>
        <svg 
          *ngIf="isConversationCopied()"
          viewBox="0 0 24 24" 
          class="h-4 w-4" 
          fill="none" 
          stroke="currentColor" 
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
        </svg>
        {{ isConversationCopied() ? 'Copied!' : 'Copy Conversation' }}
      </button>
      <button
        type="button"
        class="flex items-center gap-2 rounded-lg border border-neutral-200 bg-white px-4 py-2 text-sm font-medium text-neutral-600 transition hover:bg-neutral-50 hover:text-neutral-900"
        (click)="clearChat()"
      >
        <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        New Chat
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <div class="flex flex-1 overflow-hidden">
    <!-- Chat Area -->
    <div class="flex flex-1 flex-col">
      <!-- Messages -->
      <div #messagesContainer class="flex-1 overflow-y-auto">
        <!-- Empty State -->
        <div *ngIf="messages().length === 0 && !isLoading()" class="flex h-full flex-col items-center justify-center px-4 py-12">
          <div class="mb-8 flex h-24 w-24 items-center justify-center rounded-3xl bg-white shadow-2xl ring-1 ring-red-100">
            <svg viewBox="0 0 24 24" class="h-12 w-12 text-red-500" fill="none" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 006.16-12.12A14.98 14.98 0 009.63 8.41m5.96 5.96a14.926 14.926 0 01-5.84 2.58m-.1-8.57L6.98 9.8a2 2 0 00-.23 2.33l3.35 5.35m.1-8.57l-3.8 3.78a2 2 0 00.09 2.9l3.71 3.3" />
            </svg>
          </div>
          <h2 class="mb-3 text-2xl font-semibold text-neutral-900">How can I help you today?</h2>
          <p class="mb-10 max-w-md text-center text-neutral-500">
            Ask me anything about prompt engineering, AI best practices, or get help crafting the perfect prompts.
          </p>
          
          <!-- Suggestions Grid -->
          <div class="grid max-w-3xl grid-cols-1 gap-4 px-4 sm:grid-cols-2">
            <button 
              type="button"
              class="group flex flex-col gap-2 rounded-2xl border border-neutral-200 bg-white p-5 text-left transition hover:border-red-200 hover:shadow-lg hover:shadow-red-500/5"
              (click)="sendQuickPrompt('Ignite My Goals')"
            >
              <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-red-50 text-red-600 transition group-hover:bg-red-100">
                <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v4m-6.364.636l2.828 2.828M3 15h4m10 0h4m-3.464-8.364l-2.828 2.828M12 17v4m-5.657-1.636l2.828-2.828m8.486 2.828l-2.828-2.828" />
                </svg>
              </div>
              <span class="font-medium text-neutral-900">Ignite My Goals</span>
              <span class="text-sm text-neutral-500">Guide me through the Ignition Blueprint step-by-step.</span>
            </button>
            
            <button 
              type="button"
              class="group flex flex-col gap-2 rounded-2xl border border-neutral-200 bg-white p-5 text-left transition hover:border-red-200 hover:shadow-lg hover:shadow-red-500/5"
              (click)="sendQuickPrompt('Build My Instant Shift Playbook')"
            >
              <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-red-50 text-red-600 transition group-hover:bg-red-100">
                <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M5 16h10M9 8h10M7 4h10" />
                </svg>
              </div>
              <span class="font-medium text-neutral-900">Instant Shift Playbook</span>
              <span class="text-sm text-neutral-500">Walk me through the 7 momentum-shifting questions.</span>
            </button>
            
            <button 
              type="button"
              class="group flex flex-col gap-2 rounded-2xl border border-neutral-200 bg-white p-5 text-left transition hover:border-red-200 hover:shadow-lg hover:shadow-red-500/5"
              (click)="sendQuickPrompt('Help me engage with Exponential Effort using the ROCKET framework.')"
            >
              <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-red-50 text-red-600 transition group-hover:bg-red-100">
                <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-6-6h12" />
                </svg>
              </div>
              <span class="font-medium text-neutral-900">Exponential Effort</span>
              <span class="text-sm text-neutral-500">Push me past my limits with disciplined action steps.</span>
            </button>
            
            <button 
              type="button"
              class="group flex flex-col gap-2 rounded-2xl border border-neutral-200 bg-white p-5 text-left transition hover:border-red-200 hover:shadow-lg hover:shadow-red-500/5"
              (click)="sendQuickPrompt('Coach me using the CREW Team Method to strengthen my team performance.')"
            >
              <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-red-50 text-red-600 transition group-hover:bg-red-100">
                <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M7 8a4 4 0 118 0 4 4 0 01-8 0zm-3 13a6 6 0 0112 0H4zm12-9h3m0 0h3m-3 0v-3m0 3v3" />
                </svg>
              </div>
              <span class="font-medium text-neutral-900">CREW Team Method</span>
              <span class="text-sm text-neutral-500">Help my team grow with Courage, Recognition, Expansion, wisdom.</span>
            </button>
          </div>
        </div>

        <!-- Message List -->
        <div *ngIf="messages().length > 0" class="mx-auto max-w-4xl space-y-6 px-4 py-8">
          <div
            *ngFor="let message of messages(); trackBy: trackByTimestamp"
            class="message-bubble"
          >
            <!-- User Message -->
            <div *ngIf="message.role === 'user'" class="flex justify-end group">
              <div class="relative max-w-[80%] rounded-2xl rounded-br-md bg-neutral-900 px-5 py-4 text-white shadow-sm">
                <p class="text-[15px] leading-relaxed">{{ message.content }}</p>
                <!-- Copy Button -->
                <button
                  type="button"
                  class="copy-button absolute -left-2 -bottom-2 flex h-8 w-8 items-center justify-center rounded-lg bg-white text-neutral-500 shadow-md ring-1 ring-black/5 opacity-0 transition-all duration-200 hover:bg-red-50 hover:text-red-600 hover:shadow-lg hover:scale-110 group-hover:opacity-100"
                  [class.opacity-100]="isCopied(message)"
                  [class.text-red-600]="isCopied(message)"
                  [class.bg-red-50]="isCopied(message)"
                  (click)="copyMessage(message)"
                  [attr.aria-label]="isCopied(message) ? 'Copied!' : 'Copy message'"
                  [attr.title]="isCopied(message) ? 'Copied!' : 'Copy message'"
                >
                  <svg 
                    *ngIf="!isCopied(message)"
                    viewBox="0 0 24 24" 
                    class="h-4 w-4" 
                    fill="none" 
                    stroke="currentColor" 
                    stroke-width="2"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
                  </svg>
                  <svg 
                    *ngIf="isCopied(message)"
                    viewBox="0 0 24 24" 
                    class="h-4 w-4" 
                    fill="none" 
                    stroke="currentColor" 
                    stroke-width="2"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                  </svg>
                  <span class="copy-tooltip">{{ isCopied(message) ? 'Copied' : 'Copy' }}</span>
                </button>
              </div>
            </div>

            <!-- AI Message -->
            <div *ngIf="message.role === 'model'" class="flex gap-4 group">
              <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-white text-red-600 ring-1 ring-red-100">
                <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 006.16-12.12A14.98 14.98 0 009.63 8.41m5.96 5.96a14.926 14.926 0 01-5.84 2.58" />
                </svg>
              </div>
              <div class="relative max-w-[85%] rounded-2xl rounded-tl-md bg-white px-5 py-4 shadow-sm ring-1 ring-black/5">
                <div class="prose prose-neutral prose-sm max-w-none text-[15px] leading-relaxed" [innerHTML]="formatMessage(message.content)"></div>
                <!-- Copy Button -->
                <button
                  type="button"
                  class="copy-button absolute -left-2 -bottom-2 flex h-8 w-8 items-center justify-center rounded-lg bg-white text-neutral-500 shadow-md ring-1 ring-black/5 opacity-0 transition-all duration-200 hover:bg-red-50 hover:text-red-600 hover:shadow-lg hover:scale-110 group-hover:opacity-100"
                  [class.opacity-100]="isCopied(message)"
                  [class.text-red-600]="isCopied(message)"
                  [class.bg-red-50]="isCopied(message)"
                  (click)="copyMessage(message)"
                  [attr.aria-label]="isCopied(message) ? 'Copied!' : 'Copy message'"
                  [attr.title]="isCopied(message) ? 'Copied!' : 'Copy message'"
                >
                  <svg 
                    *ngIf="!isCopied(message)"
                    viewBox="0 0 24 24" 
                    class="h-4 w-4" 
                    fill="none" 
                    stroke="currentColor" 
                    stroke-width="2"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
                  </svg>
                  <svg 
                    *ngIf="isCopied(message)"
                    viewBox="0 0 24 24" 
                    class="h-4 w-4" 
                    fill="none" 
                    stroke="currentColor" 
                    stroke-width="2"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                  </svg>
                  <span class="copy-tooltip">{{ isCopied(message) ? 'Copied' : 'Copy' }}</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Loading Indicator -->
          <div *ngIf="isLoading()" class="flex gap-4">
            <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-white text-red-600 ring-1 ring-red-100">
              <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 006.16-12.12A14.98 14.98 0 009.63 8.41m5.96 5.96a14.926 14.926 0 01-5.84 2.58" />
              </svg>
            </div>
            <div class="flex items-center gap-3 rounded-2xl rounded-tl-md bg-white px-5 py-4 shadow-sm ring-1 ring-black/5">
              <div class="flex gap-1.5">
                <span class="h-2.5 w-2.5 animate-bounce rounded-full bg-red-500" style="animation-delay: 0ms;"></span>
                <span class="h-2.5 w-2.5 animate-bounce rounded-full bg-red-500" style="animation-delay: 150ms;"></span>
                <span class="h-2.5 w-2.5 animate-bounce rounded-full bg-red-500" style="animation-delay: 300ms;"></span>
              </div>
              <span class="text-sm text-neutral-400">Thinking...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="error()" class="border-t border-red-100 bg-red-50 px-6 py-3">
        <div class="mx-auto max-w-4xl">
          <p class="text-sm text-red-600">{{ error() }}</p>
        </div>
      </div>

      <!-- Input Area -->
      <div class="border-t border-neutral-200 bg-white px-4 py-5">
        <div class="mx-auto max-w-4xl">
          <div class="flex gap-4">
            <div class="relative flex-1">
              <textarea
                #messageInput
                class="max-h-40 min-h-[56px] w-full resize-none rounded-2xl border border-neutral-200 bg-neutral-50 px-5 py-4 pr-14 text-[15px] text-neutral-900 placeholder-neutral-400 outline-none transition focus:border-neutral-300 focus:bg-white focus:ring-2 focus:ring-red-500/10"
                placeholder="Message RocketGoals AI..."
                rows="1"
                [value]="inputMessage()"
                (input)="inputMessage.set($any($event.target).value)"
                (keydown)="handleKeydown($event)"
                [disabled]="isLoading()"
              ></textarea>
              <button
                type="button"
                class="absolute bottom-3 right-3 flex h-10 w-10 items-center justify-center rounded-xl bg-red-600 text-white shadow-lg shadow-red-500/25 transition-all hover:bg-red-700 hover:shadow-red-500/35 disabled:bg-neutral-200 disabled:text-neutral-400 disabled:shadow-none"
                [disabled]="isLoading() || !inputMessage().trim()"
                (click)="sendMessage()"
                aria-label="Send message"
              >
                <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                </svg>
              </button>
            </div>
          </div>
          <p class="mt-3 text-center text-xs text-neutral-400">
            RocketGoals AI can make mistakes. Consider checking important information.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
