<ng-container *ngIf="user$ | async as user; else loggedOut">
  <section class="mx-auto max-w-3xl space-y-6 rounded-3xl border border-slate-300 bg-slate-50 p-8 text-slate-900 shadow-2xl">
    <div class="space-y-2">
      <p class="text-sm font-semibold uppercase tracking-[0.35em] text-[#DC2626]">Verify email</p>
      <h1 class="text-3xl font-bold text-slate-900">Check your inbox, {{ user.displayName || 'friend' }}.</h1>
      <p class="text-sm text-slate-600">
        We sent a verification link to <span class="font-medium text-[#DC2626]">{{ user.email }}</span>. Click the link and then refresh your status here.
      </p>
    </div>

    <div class="space-y-4 rounded-2xl border border-slate-300 bg-white p-5 text-sm text-slate-600">
      <p class="font-semibold text-slate-900">Troubleshooting tips</p>
      <ul class="list-disc space-y-1 pl-5">
        <li>Look in spam, promotions, or updates folders.</li>
        <li>The link expires after a short time—resend if needed.</li>
        <li>Still not working? Resend below or contact your Firebase project admin.</li>
      </ul>
    </div>

    <div *ngIf="feedbackMessage" class="rounded-2xl border p-4 text-sm" [ngClass]="{
      'border-emerald-400/40 bg-emerald-400/10 text-emerald-200': feedbackType === 'success',
      'border-rose-500/50 bg-rose-500/10 text-rose-200': feedbackType === 'error'
    }">
      {{ feedbackMessage }}
    </div>

    <div class="flex flex-col gap-3 md:flex-row">
      <button
        type="button"
        (click)="refreshStatus()"
        [disabled]="isReloading"
        class="flex-1 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-500 px-4 py-3 text-sm font-semibold uppercase tracking-wide text-white transition hover:from-emerald-400 hover:to-teal-400 disabled:cursor-not-allowed disabled:from-white/20 disabled:to-white/10 disabled:text-white/50"
      >
        {{ isReloading ? 'Checking...' : 'I verified my email' }}
      </button>

      <button
        type="button"
        (click)="resendEmail()"
        [disabled]="isResending"
        class="flex-1 rounded-xl border border-white/20 px-4 py-3 text-sm font-semibold uppercase tracking-wide text-white transition hover:border-white/40 hover:bg-white/10 disabled:cursor-not-allowed disabled:border-white/10 disabled:text-white/50"
      >
        {{ isResending ? 'Sending...' : 'Resend verification email' }}
      </button>
    </div>

    <p class="text-xs text-slate-600">
      Signed in as {{ user.email }} ·
      <a routerLink="/auth" class="font-semibold text-[#DC2626] hover:text-[#B91C1C]">Use a different account</a>
    </p>
  </section>
</ng-container>

<ng-template #loggedOut>
  <section class="mx-auto max-w-2xl rounded-3xl border border-slate-300 bg-slate-50 p-8 text-center text-slate-900 shadow-2xl">
    <h1 class="text-3xl font-bold text-slate-900">Let's get you signed in again</h1>
    <p class="mt-4 text-sm text-slate-600">We lost track of your session. Head back to the login screen and we'll pick up where you left off.</p>
    <a
      routerLink="/auth"
      class="mt-6 inline-flex items-center gap-2 rounded-xl bg-[#DC2626] px-5 py-3 text-sm font-semibold uppercase tracking-wide text-white transition hover:bg-[#B91C1C]"
    >
      <span aria-hidden="true">↩</span>
      Back to login
    </a>
  </section>
</ng-template>
